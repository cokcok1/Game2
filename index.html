<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è–ç¶“é‡‘å¥é‡çµ„æŒ‘æˆ° Pro</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@600;900&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        :root {
            --primary-color: #6C5CE7;
            --accent-color: #FDCB6E;
            --success-color: #00b894;
            --error-color: #d63031;
            --text-dark: #2d3436;
            --glass-bg: rgba(20, 20, 20, 0.7);
            --card-bg: rgba(255, 255, 255, 0.95);
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            /* èƒŒæ™¯åœ–æ›´æ›ç‚ºæ›´æ¸…æ™°çš„ */
            background: url('https://images.unsplash.com/photo-1504608524841-42fe6f032b4b?q=80&w=2000&auto=format&fit=crop') no-repeat center center fixed;
            background-size: cover;
            color: var(--text-dark);
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            padding: 10px;
            box-sizing: border-box;
            position: relative; /* For watermark positioning */
        }

        /* èƒŒæ™¯é®ç½© */
        body::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.4);
            z-index: -1;
        }

        .game-container {
            max-width: 600px;
            width: 100%;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 24px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: height 0.3s; 
            margin-bottom: 30px; /* ç•™ä½çµ¦æµ®æ°´å° */
        }

        .hud {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            color: white;
        }

        .lives { letter-spacing: 2px; }
        .score-board { color: var(--accent-color); font-weight: 700; }

        .verse-card {
            background: var(--card-bg);
            padding: 15px 10px;
            border-radius: 16px;
            text-align: center;
            min-height: 50px; 
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }

        .verse-ref {
            font-family: 'Noto Serif TC', serif;
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--text-dark);
            margin: 0;
        }

        /* Loading ç‹€æ…‹çš„æ–‡å­—å¤§å°èª¿æ•´ */
        .verse-ref.loading {
            font-size: 1.1rem;
            color: #666;
            font-weight: 500;
        }

        .zone-label {
            color: rgba(255,255,255,0.8);
            font-size: 0.8rem;
            margin-left: 5px;
            margin-bottom: 4px;
        }

        .zone {
            height: 140px; 
            padding: 10px;
            border-radius: 16px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-content: flex-start; 
            gap: 8px;
            overflow-y: auto; 
            transition: border-color 0.3s;
        }

        .zone::-webkit-scrollbar { width: 6px; }
        .zone::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.3); border-radius: 3px; }

        .answer-zone {
            background-color: rgba(255, 255, 255, 0.95);
            border: 2px solid transparent;
        }

        .answer-zone.correct {
            border-color: var(--success-color);
            background-color: #d1f2eb;
        }

        .answer-zone.wrong {
            border-color: var(--error-color);
            background-color: #fadbd8;
            animation: shake 0.4s;
        }

        .option-zone {
            background-color: rgba(0, 0, 0, 0.25);
            border: 1px dashed rgba(255,255,255,0.2);
        }

        .word-brick {
            background: #fff;
            border-bottom: 3px solid #ced6e0;
            border-radius: 8px;
            padding: 8px 14px;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-dark);
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            user-select: none;
            height: fit-content; 
        }
        
        .word-brick:active {
            transform: translateY(2px);
            border-bottom-width: 0;
            margin-bottom: 3px;
        }

        .controls {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 10px;
            margin-top: 5px;
        }

        .btn {
            border: none;
            padding: 14px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            color: white;
            box-shadow: 0 4px 0 rgba(0,0,0,0.2);
            transition: all 0.1s;
        }

        .btn:active { transform: translateY(4px); box-shadow: none; }
        .btn-reset { background: #636e72; }
        .btn-submit { background: linear-gradient(135deg, var(--primary-color), #a29bfe); }
        .btn:disabled { background: #b2bec3; box-shadow: none; transform: translateY(4px); color: #dfe6e9; }

        #message {
            text-align: center;
            height: 24px;
            color: white;
            font-size: 0.95rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        .answer-placeholder {
            width: 100%;
            text-align: center;
            color: #aaa;
            margin-top: 50px;
            pointer-events: none;
        }

        /* å½ˆçª— */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 999;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }

        .modal-card {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            width: 85%;
            max-width: 320px;
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* --- æµ®æ°´å°æ¨£å¼ --- */
        .watermark {
            position: fixed;
            bottom: 10px;
            right: 15px;
            color: rgba(255, 255, 255, 0.6); /* åŠé€æ˜ç™½è‰² */
            font-size: 0.75rem;
            text-align: right;
            z-index: 100;
            pointer-events: none; /* ç¢ºä¿ä¸æœƒæ“‹ä½é»æ“Š */
            text-shadow: 0 1px 2px rgba(0,0,0,0.8);
        }

        @keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        @keyframes shake { 0%, 100% {transform: translateX(0);} 25% {transform: translateX(-5px);} 75% {transform: translateX(5px);} }

    </style>
</head>
<body>

<div class="game-container">
    <div class="hud">
        <div class="lives" id="livesDisplay">â¤ï¸â¤ï¸â¤ï¸</div>
        <div class="score-board" id="scoreDisplay">SCORE: 0</div>
    </div>

    <div class="verse-card">
        <div class="verse-ref loading" id="referenceDisplay">æ­£åœ¨è¼‰å…¥é‡‘å¥é¡Œåº«...</div>
    </div>

    <div>
        <div class="zone-label">ä½ çš„æ’åˆ—</div>
        <div class="zone answer-zone" id="answerZone">
            </div>
    </div>

    <div>
        <div class="zone-label">è©èªé¸é …</div>
        <div class="zone option-zone" id="optionZone">
            </div>
    </div>

    <div id="message"></div>

    <div class="controls">
        <button class="btn btn-reset" id="resetBtn" onclick="resetRound()" disabled>é‡ç½®</button>
        <button class="btn btn-submit" id="checkBtn" onclick="checkAnswer()" disabled>æäº¤ç­”æ¡ˆ</button>
    </div>
</div>

<div class="modal-overlay" id="gameModal">
    <div class="modal-card">
        <h2 style="color:var(--primary-color); margin-top:0;" id="modalTitle">TITLE</h2>
        <p id="modalText" style="color:#555; margin-bottom:20px;">Text</p>
        <button class="btn btn-submit" style="width:100%" onclick="handleModalAction()">ç¹¼çºŒ</button>
    </div>
</div>

<div class="watermark">
    Powered by Gemini<br>
    Version: 1.2 | Date: 2023-10-27
</div>

<script>
    // --- 1. è³‡æ–™åº«è®Šæ•¸ (ä¸å†æ˜¯å¯«æ­»çš„å…§å®¹ï¼Œè€Œæ˜¯ç­‰å¾…è¼‰å…¥) ---
    let versesData = [];
    const DATA_URL = 'https://cokcok1.github.io/Game2/Bible-Verses-Life.txt';

    // --- 2. éŠæˆ²è®Šæ•¸ ---
    let currentScore = 0;
    let lives = 3;
    let currentVerseIndex = 0;
    let currentSegments = []; 
    let shuffledSegments = []; 
    let playerAnswer = []; 
    let isDataLoaded = false;

    // --- 3. æ–°å¢ï¼šè®€å–å¤–éƒ¨æª”æ¡ˆçš„å‡½æ•¸ ---
    async function loadVersesDatabase() {
        try {
            const response = await fetch(DATA_URL);
            if (!response.ok) throw new Error('ç¶²è·¯å›æ‡‰éŒ¯èª¤');
            const text = await response.text();
            parseTextToData(text);
        } catch (error) {
            console.error('Error loading verses:', error);
            document.getElementById('referenceDisplay').innerText = "è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡æˆ–æª”æ¡ˆæ ¼å¼";
            document.getElementById('referenceDisplay').classList.add('loading');
            showMessage("ç„¡æ³•è®€å–é‡‘å¥æª”æ¡ˆï¼Œè«‹åˆ·æ–°é é¢é‡è©¦ã€‚", "#ff7675");
        }
    }

    // --- 4. æ–°å¢ï¼šè§£ææ–‡å­—æª”å…§å®¹çš„å‡½æ•¸ ---
    function parseTextToData(text) {
        const lines = text.split('\n');
        versesData = []; // æ¸…ç©ºç¾æœ‰è³‡æ–™

        lines.forEach(line => {
            // è·³éç©ºè¡Œ
            if (!line.trim()) return; 

            // å°‹æ‰¾ç¬¬ä¸€å€‹å†’è™Ÿçš„ä½ç½®ä¾†åˆ†éš”å‡ºè™•å’Œå…§å®¹
            const firstColonIndex = line.indexOf(':');
            if (firstColonIndex === -1) return; // å¦‚æœæ²’æœ‰å†’è™Ÿï¼Œè·³éæ­¤è¡Œ

            const ref = line.substring(0, firstColonIndex).trim();
            const contentRaw = line.substring(firstColonIndex + 1).trim();

            // ç”¨æ–œç·š / åˆ†å‰²å…§å®¹
            // ä½¿ç”¨ filter éæ¿¾æ‰å¯èƒ½ç”¢ç”Ÿçš„ç©ºå­—ä¸²ï¼ˆä¾‹å¦‚è¡Œå°¾å¤šäº†ä¸€å€‹ /ï¼‰
            const segments = contentRaw.split('/').map(seg => seg.trim()).filter(seg => seg.length > 0);

            if (ref && segments.length > 0) {
                versesData.push({ ref, segments });
            }
        });

        if (versesData.length > 0) {
            isDataLoaded = true;
            document.getElementById('checkBtn').disabled = false;
            initGame();
        } else {
             document.getElementById('referenceDisplay').innerText = "é¡Œåº«æª”æ¡ˆæ˜¯ç©ºçš„æˆ–æ ¼å¼éŒ¯èª¤";
        }
    }

    // --- 5. éŠæˆ²æ ¸å¿ƒåŠŸèƒ½ ---

    function initGame() {
        if (!isDataLoaded) return;
        currentScore = 0;
        lives = 3;
        currentVerseIndex = Math.floor(Math.random() * versesData.length);
        updateUI();
        loadLevel();
    }

    function loadLevel() {
        const verseObj = versesData[currentVerseIndex % versesData.length];
        
        const refDisplay = document.getElementById('referenceDisplay');
        refDisplay.innerText = verseObj.ref;
        refDisplay.classList.remove('loading'); // ç§»é™¤è¼‰å…¥ä¸­çš„æ¨£å¼
        
        document.getElementById('message').innerText = "";
        document.getElementById('answerZone').className = "zone answer-zone";
        
        const checkBtn = document.getElementById('checkBtn');
        checkBtn.innerText = "æäº¤ç­”æ¡ˆ";
        checkBtn.onclick = checkAnswer;
        checkBtn.style.background = ""; 

        currentSegments = [...verseObj.segments];
        shuffledSegments = [...verseObj.segments];
        playerAnswer = [];
        
        shuffleArray(shuffledSegments);
        renderZones();
    }

    function resetRound() {
        shuffledSegments = shuffledSegments.concat(playerAnswer);
        playerAnswer = [];
        renderZones();
    }

    function renderZones() {
        const answerZone = document.getElementById('answerZone');
        const optionZone = document.getElementById('optionZone');
        const resetBtn = document.getElementById('resetBtn');

        answerZone.innerHTML = '';
        optionZone.innerHTML = '';

        if (playerAnswer.length === 0) {
            answerZone.innerHTML = '<div class="answer-placeholder">é»æ“Šä¸‹æ–¹è©èªä¾åºæ’åˆ—</div>';
            resetBtn.disabled = true;
        } else {
            resetBtn.disabled = false;
        }

        playerAnswer.forEach((text, index) => {
            answerZone.appendChild(createBrick(text, true, index));
        });

        shuffledSegments.forEach((text, index) => {
            optionZone.appendChild(createBrick(text, false, index));
        });
    }

    function createBrick(text, isAnswerZone, index) {
        let div = document.createElement('div');
        div.className = 'word-brick';
        div.innerText = text;
        div.onclick = function() {
            if (isAnswerZone) {
                const word = playerAnswer[index];
                playerAnswer.splice(index, 1);
                shuffledSegments.push(word);
            } else {
                const word = shuffledSegments[index];
                shuffledSegments.splice(index, 1);
                playerAnswer.push(word);
            }
            renderZones();
        };
        return div;
    }

    function checkAnswer() {
        if (playerAnswer.length === 0) {
             showMessage("è«‹å…ˆé¸æ“‡è©èªï¼", "#ffeaa7");
             return;
        }

        let isCorrect = true;
        if (playerAnswer.length !== currentSegments.length) isCorrect = false;
        else {
            for (let i = 0; i < currentSegments.length; i++) {
                if (playerAnswer[i] !== currentSegments[i]) {
                    isCorrect = false;
                    break;
                }
            }
        }

        const answerZone = document.getElementById('answerZone');

        if (isCorrect) {
            currentScore++;
            answerZone.classList.add('correct');
            showMessage("ç­”å°äº†ï¼é˜¿å€‘ï¼", "#55efc4");
            
            const btn = document.getElementById('checkBtn');
            btn.innerText = "ä¸‹ä¸€é¡Œ â”";
            btn.style.background = "#00b894"; 
            btn.onclick = nextLevel;
            
            triggerConfetti();

        } else {
            lives--;
            answerZone.classList.add('wrong');
            showMessage("é †åºä¸å°ï¼Œè«‹é‡è©¦ï¼", "#ff7675");
            updateUI();
            
            setTimeout(() => {
                answerZone.classList.remove('wrong');
            }, 1000);

            if (lives <= 0) {
                showModal("Game Over", `æœ€çµ‚å¾—åˆ†ï¼š<b>${currentScore}</b><br>ä¼‘æ¯ä¸€ä¸‹ï¼Œé‡æ–°å¾—åŠ›ï¼`, "é‡æ–°æŒ‘æˆ°");
            }
        }
    }

    function nextLevel() {
        currentVerseIndex++;
        loadLevel();
        updateUI();
    }

    function showMessage(text, color) {
        const msg = document.getElementById('message');
        msg.innerText = text;
        msg.style.color = color;
    }

    function updateUI() {
        let hearts = "";
        for(let i=0; i<lives; i++) hearts += "â¤ï¸";
        for(let i=lives; i<3; i++) hearts += "ğŸ–¤"; 
        document.getElementById('livesDisplay').innerText = hearts;
        document.getElementById('scoreDisplay').innerText = "SCORE: " + currentScore;
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function triggerConfetti() {
        confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
    }

    function showModal(title, text, btnText) {
        document.getElementById('modalTitle').innerHTML = title; 
        document.getElementById('modalText').innerHTML = text;
        document.querySelector('#gameModal .btn-submit').innerText = btnText;
        document.getElementById('gameModal').style.display = 'flex';
    }

    function handleModalAction() {
        document.getElementById('gameModal').style.display = 'none';
        initGame();
    }

    // --- ç¨‹å¼å…¥å£ ---
    // é é¢è¼‰å…¥å¾Œï¼Œå…ˆåŸ·è¡Œè®€å–è³‡æ–™åº«çš„å‹•ä½œ
    loadVersesDatabase();

</script>

</body>
</html>
